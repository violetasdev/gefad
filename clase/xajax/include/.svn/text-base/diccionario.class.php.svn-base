<?
function formDicc($tipo)
{	//rescata el valor de la configuracion
	require_once("clase/config.class.php");
	setlocale(LC_MONETARY, 'en_US');
	
	$esta_configuracion=new config();
	$configuracion=$esta_configuracion->variable(); 
	//Buscar un registro que coincida con el valor
	include_once($configuracion["raiz_documento"].$configuracion["clases"]."/html.class.php");
	// crea objeto y se conecta a la base de datos
	$acceso_db=new dbms($configuracion);
	$enlace=$acceso_db->conectar_db();	
	$html=new html();
	
	//echo $busqueda;
	$formulario="tipo_obj";
	$verificar="control_vacio(".$formulario.",'valor')";
	$verificar.="&& control_vacio(".$formulario.",'descripcion')";
	
	//se crea el formulario para enviarlo y mostrarlo por xajax
	$cadena_html="
	<form enctype='tipo:multipart/form-data,application/x-www-form-urlencoded,text/plain' method='POST' name='".$formulario."' id='".$formulario."'>
	<table class='bloquelateral' align='center' width='100%' cellpadding='0' cellspacing='0'>
	<tr>
	<td>
	<table align='center' width='100%' cellpadding='7' cellspacing='1'>
		<tr class='texto_subtitulo'>
				<td colspan='3'>
				Agregar ".$tipo." de Objeto	
				<hr class='hr_subtitulo'>
			</tr>
		<tr class='bloquecentralcuerpo'>
			<td >* Servidor </td>
			<td>
				<input type='text' name='server' id='server' size='40' maxlength='100'>
			</td>
	
		</tr>
		<tr class='bloquecentralcuerpo' >
			<td>*	Base de Datos	</td>
			<td>
				<input type='text' name='db_name' id='db_name' size='40' maxlength='255'>
			</td>
		</tr>
		<tr class='bloquecentralcuerpo' >
			<td>*	Usuario	</td>
			<td>
				<input type='text' name='db_user' id='db_user' size='40' maxlength='255'>
			</td>
		</tr>
		<tr class='bloquecentralcuerpo' >
			<td>*	Clave	</td>
			<td>
				<input type='text' name='db_name' id='db_name' size='40' maxlength='255'>
			</td>
		</tr>
		<tr align='center'>
			<td colspan='2' rowspan='1'>
				<input type='hidden' name='tipo' id='tipo' value='".$tipo."'>
				<input value='Guardar Tipo' name='aceptar' type='button' onclick=\"if(".$verificar."){xajax_procesar_formulario(xajax.getFormValues('".$formulario."'))}else{false}\">
				
			</td>
		</tr>
	</table>
	</td>
	</tr>
	</table>
	</form>
	";
	//se crea el objeto xajax para enviar la respuesta
	$respuesta = new xajaxResponse();
	//Se asignan los valores al objeto y se envia la respuesta	
	$respuesta->addAssign("divForm","innerHTML",$cadena_html);
	return $respuesta;
}

function procesar_formulario($form_entrada)
{
	//rescata el valor de la configuracion
	require_once("clase/config.class.php");
	setlocale(LC_MONETARY, 'en_US');
	
	$esta_configuracion=new config();
	$configuracion=$esta_configuracion->variable(); 
	//Buscar un registro que coincida con el valor
	include_once($configuracion["raiz_documento"].$configuracion["clases"]."/html.class.php");
	include_once($configuracion["raiz_documento"].$configuracion["clases"]."/log.class.php");
	// crea objeto y se conecta a la base de datos
	$acceso_db=new dbms($configuracion);
	$enlace=$acceso_db->conectar_db();	
	$html=new html();
	
	//sentencia que agrega la nueva variable	
	$cadena_sql="INSERT INTO "; 
	$cadena_sql.=$configuracion["prefijo"]."variable ";
	$cadena_sql.="( "; 
	$cadena_sql.="`id_tipo`, "; 
	$cadena_sql.="`valor`, ";
	$cadena_sql.="`descripcion`, "; 
	$cadena_sql.="`tipo` "; 
	$cadena_sql.=") "; 
	$cadena_sql.="VALUES "; 
	$cadena_sql.="( "; 
	$cadena_sql.="NULL, ";
	$cadena_sql.="'".$form_entrada["valor"]."', "; 
	$cadena_sql.="'".$form_entrada["descripcion"]."', "; 
	$cadena_sql.="'TIPO_OBJETO' ";
	$cadena_sql.=")"; 
// 	ECHO $cadena_sql; EXIT;
	$resultado=$acceso_db->ejecutarAcceso($cadena_sql,"busqueda");
	$recuperado=mysql_insert_id();

	
	//VARIABLES PARA EL LOG

	$log_us= new log();
	$registro[0]="CREAR";
	$registro[1]= $recuperado;
	$registro[2]="TIPO_OBJETO";
	$registro[3]=$form_entrada["valor"];
	$registro[4]=time();
	$registro[5]="Se registra un tipo de Objeto de Diccionario de datos, con nombre ".$registro[3];
	$log_us->log_usuario($registro,$configuracion);

	$respuesta = new xajaxResponse();
	$respuesta->addAssign("divForm","innerHTML","");	

	//genera la nueva busqueda para los selectes
	$html=new html();
	$busqueda="SELECT id_tipo,valor FROM ".$configuracion["prefijo"]."variable WHERE tipo='TIPO_OBJETO' ORDER BY valor";
	
	$busqueda="SELECT id_tipo,valor ";
	$busqueda.="FROM ";
	$busqueda.=$configuracion["prefijo"]."variable ";
	$busqueda.="WHERE ";
	$busqueda.="tipo='TIPO_OBJETO'";
	$busqueda.="ORDER BY valor";
		
	$mi_cuadro=$html->cuadro_lista($busqueda,"id_tipo",$configuracion,$recuperado,1,FALSE,0,"id_tipo");
	$respuesta->addAssign("divTipo","innerHTML",$mi_cuadro);
	//tenemos que devolver la instanciaciÃ³n del objeto xajaxResponse
	return $respuesta;
}

?>
